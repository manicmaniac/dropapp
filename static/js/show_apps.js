// Generated by CoffeeScript 1.11.1
var appsTable;

appsTable = new Vue({
  el: '#apps-table',
  data: {
    apps: []
  },
  filters: {
    formatDate: function(v) {
      return v.replace(/T|Z/g, ' ');
    }
  },
  methods: {
    reload: function() {
      return superagent.get('/api/apps').set('Accept', 'application/vnd.api+json').end((function(_this) {
        return function(err, res) {
          var body;
          body = res.body || JSON.parse(res.text);
          return body.data.forEach(function(object, i) {
            var app;
            app = object.attributes;
            app.id = object.id;
            return _this.apps.$set(i, app);
          });
        };
      })(this));
    },
    remove: function(event) {
      var app, index;
      index = event.target.attributes['data-index'].value;
      app = this.apps[index];
      return superagent.del("/api/apps/" + app.id).set('Accept', 'application/vnd.api+json').end((function(_this) {
        return function(err, res) {
          return _this.apps.$remove(app);
        };
      })(this));
    }
  }
});

document.addEventListener('DOMContentLoaded', appsTable.reload);

Dropzone.options.appDropzone = {
  init: function() {
    this.on('success', (function(_this) {
      return function(file, res) {
        var app;
        app = res.attributes;
        app.id = res.id;
        appsTable.apps.push(app);
        return _this.removeAllFiles();
      };
    })(this));
    return this.on('error', function(file, res) {
      return file.previewElement.getElementByClassName('dz-error-message')[0].innerText = res.message;
    });
  }
};
